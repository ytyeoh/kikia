<script>
$(document).ready(function(){
  Dropzone.autoDiscover = false;
  var myDropzone = new Dropzone('#listing_form', {
    paramName: "listing[image]", // The name that will be used to transfer the file
    maxFilesize: 2, // MB
    previewsContainer: "#previews",
    addRemoveLinks: true,
    autoProcessQueue: false,
    clickable: "#clickzone",
    accept: function(file, done) {
      if (file.name == "justinbieber.jpg") {
        done("Naha, you don't.");
      }
      else { done(); }
    }
  });
  $("form").on("submit", function (event) {
    event.preventDefault();
    event.stopPropagation();
    myDropzone.processQueue();
    myDropzone.processQueue(); // Tell Dropzone to process all queued files.
  });
  myDropzone.on("queuecomplete", function(file) {
    window.location.href = "/listings/owner";
  });
  // Create the mock file:
  var mockFile = { name: "image", size: 12345 };

  // Call the default addedfile event handler
  myDropzone.emit("addedfile", mockFile);

  // And optionally show the thumbnail of the file:
  myDropzone.emit("thumbnail", mockFile, "#{@listing.image.url}");
  // Or if the file on your server is not yet in the right
  // size, you can let Dropzone download and resize it
  // callback and crossOrigin are optional.
  myDropzone.createThumbnailFromUrl( imageUrl, callback, crossOrigin);

  // Make sure that there is no progress bar, etc...
  myDropzone.emit("complete", mockFile);

  // If you use the maxFiles option, make sure you adjust it to the
  // correct amount:
  var existingFileCount = 1; // The number of files already uploaded
  myDropzone.options.maxFiles = myDropzone.options.maxFiles - existingFileCount;
})
</script>